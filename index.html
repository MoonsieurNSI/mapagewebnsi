<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Language" content="fr" />
    <title>Simulateur de SMS</title>
    <style>
      /* Le CSS reste le m√™me que la version pr√©c√©dente, il n'y a pas de changements ici */
      body {
        font-family: sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
      }
      #smartphone-frame {
        width: 320px;
        height: 568px;
        border: 2px solid black;
        border-radius: 20px;
        background-color: white;
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      #chat-container {
        flex-grow: 1;
        padding: 10px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
      }
      .message-container {
        display: flex;
        margin-bottom: 10px;
      }
      .message {
        padding: 5px 15px 20px;
        border-radius: 20px;
        word-wrap: break-word;
        max-width: 70%;
        position: relative;
      }
      .message.sent {
        background-color: #dcf8c6;
        align-self: flex-end;
      }
      .message.received {
        background-color: #e1f5fe;
        align-self: flex-start;
      }
      .message-name {
        font-size: 0.8em;
        color: #007bff;
        margin-bottom: 4px;
        font-weight: bold;
        display: block;
      }
      .message-text {
        white-space: pre-wrap;
        overflow-wrap: break-word;
        word-break: break-word;
      }
      .message-time {
        position: absolute;
        bottom: 5px;
        right: 12px;
        font-size: 0.7em;
        color: #999;
      }
      .input-container {
        display: flex;
        padding: 6px 10px;
        background-color: #eee;
        align-items: center;
      }
      #message-input {
        flex-grow: 1;
        padding: 8px 12px;
        border: 1px solid #ccc;
        border-radius: 20px;
        resize: none;
        font-family: inherit;
        font-size: 1em;
        line-height: 1.4em;
        min-height: 38px;
        max-height: 120px;
        overflow-y: auto;
        box-sizing: border-box;
      }
      #send-button {
        padding: 10px 20px;
        margin-left: 8px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.2s ease-in-out;
      }
      #send-button.active {
        transform: scale(1.1);
        background-color: #5cb85c;
      }
      .align-right {
        display: flex;
        justify-content: flex-end;
      }
      .align-left {
        display: flex;
        justify-content: flex-start;
        align-items: flex-end;
      }
      .typing-indicator {
        display: flex;
        background-color: #e1f5fe;
        padding: 10px 15px;
        border-radius: 20px;
        margin-bottom: 10px;
      }
      .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #888;
        margin: 0 3px;
        animation: typing 1.4s infinite;
      }
      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }
      @keyframes typing {
        0% {
          transform: translateY(0);
        }
        25% {
          transform: translateY(-5px);
        }
        50%,
        100% {
          transform: translateY(0);
        }
      }
      .profile-picture {
        width: 35px;
        height: 35px;
        border-radius: 50%;
        margin-right: 8px;
        object-fit: cover;
        align-self: flex-end;
      }
    </style>
  </head>
  <body>
    <h1>Simulateur de SMS</h1>

    <div id="smartphone-frame">
      <div id="chat-container"></div>
      <div class="input-container">
        <!-- MODIFICATION 1 : Passage de rows="1" √† rows="2" -->
        <textarea
          id="message-input"
          rows="2"
          placeholder="Tapez votre message..."
        ></textarea>
        <button id="send-button">Envoyer</button>
      </div>
    </div>

    <script>
      const interlocutorName = "Cyril";
      const interlocutorProfilePicture = "./img/AdaLovelace.jpg";
      const actorName = "Texto fille 2025";

      const dialogue = [
        {
          speaker: interlocutorName,
          text: "Aujourd‚Äôhui, tu cherches tes mots MDR‚Ä¶Pourquoi ?",
        },
        { speaker: actorName, text: "MDR, c'est juste la connexion pourrie !" },
        { speaker: interlocutorName, text: "MDR ! Moi 5G ! Tu f√© koi ?" },
        { speaker: actorName, text: "me suis rapproch√© de la boxe. Mieux !" },
        {
          speaker: interlocutorName,
          text: "MDR ! Vas-y c'est relou par tel, je passe te voir.",
        },
        { speaker: actorName, text: "Non !" },
        { speaker: interlocutorName, text: "PQ non ?" },
        {
          speaker: actorName,
          text: "Parce que c'est mieux comme √ßa. J'pr√©f√®re.",
        },
        { speaker: interlocutorName, text: "???" },
        { speaker: interlocutorName, text: "?????????" },
        { speaker: actorName, text: "T√™te qui tourne...fatigu√© jt√© dis..." },
        { speaker: interlocutorName, text: "Trop chelou ce soir..." },
        { speaker: actorName, text: "ben m√™me pas... J'suis moi quoi !" },
        { speaker: interlocutorName, text: "Genre toi ouais mais chelou" },
        {
          speaker: interlocutorName,
          text: "Tu caches quelque chose‚Ä¶t'agis en screed. En vrai t'as un crusch ?",
        },
        { speaker: actorName, text: "G√©nance...Et si c‚Äô√©tait oui ?" },
        { speaker: interlocutorName, text: "Nan ! C√© ki ?" },
        { speaker: actorName, text: "C'est toi." },
        { speaker: interlocutorName, text: "MDR !!! Genre vraiment ?" },
        {
          speaker: actorName,
          text: "genre oui vraiment ! J'm'en fous te balance tout...\nJe t‚Äôaime. J‚Äô√©touffe. Je t‚Äôaime, je deviens dingue. Tu tournes en boucle dans ma t√™te.\nTout le temps ! Je me rappelle de tout. Chaque d√©tail, l'autre jour, t‚Äôas chang√© de\ncoiffure. Ouais, j' suis tellement fix√© sur toi, je retiens ces trucs-l√†‚Ä¶T'es mon soleil.\nEt moi, m√™me quand t‚Äôes plus l√†, j‚Äôte vois encore.",
          delayAfter: 2000,
        },
        { speaker: actorName, text: "Tu dis rien ?" },
        { speaker: actorName, text: "Toujours l√† ?" },
        { speaker: actorName, text: "GENANCE ++" },
        { speaker: actorName, text: "Dis quelque chose stp !" },
        {
          speaker: interlocutorName,
          text: "ü•∞\nEn vrai moi aussi j'suis grave dedans. In love.",
        },
      ];

      const chatContainer = document.getElementById("chat-container");
      const messageInput = document.getElementById("message-input");
      const sendButton = document.getElementById("send-button");

      let dialogueIndex = 0;
      let isTyping = false;

      function typeText(text, onComplete) {
        let index = 0;
        isTyping = true;
        messageInput.value = "";

        const typingInterval = setInterval(() => {
          if (index < text.length) {
            messageInput.value += text[index];
            messageInput.scrollTop = messageInput.scrollHeight;
            index++;
          } else {
            clearInterval(typingInterval);
            isTyping = false;
            if (onComplete) onComplete();
          }
        }, 50);
      }

      sendButton.addEventListener("click", () => {
        if (!isTyping) sendMessage();
      });

      messageInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter" && !event.shiftKey) {
          event.preventDefault();
          if (!isTyping) {
            sendMessage();
          }
        }
      });

      function sendMessage() {
        let messageText = messageInput.value.trim();
        if (messageText === "") return;

        sendButton.classList.add("active");
        setTimeout(() => sendButton.classList.remove("active"), 200);

        const sentMessageObject = dialogue[dialogueIndex];
        addMessage(messageText, "sent", null);
        messageInput.value = "";

        dialogueIndex++;

        if (sentMessageObject && sentMessageObject.delayAfter) {
          setTimeout(handleNextMessage, sentMessageObject.delayAfter);
        } else {
          handleNextMessage();
        }
      }

      function handleNextMessage() {
        if (dialogueIndex >= dialogue.length) return;

        const nextMessage = dialogue[dialogueIndex];

        if (nextMessage.speaker === interlocutorName) {
          const typingIndicator = showTypingIndicator();
          setTimeout(() => {
            removeTypingIndicator(typingIndicator);
            addMessage(
              nextMessage.text,
              "received",
              interlocutorName,
              interlocutorProfilePicture
            );

            dialogueIndex++;
            handleNextMessage();
          }, getRandomDelay(1500, 2500));
        } else if (nextMessage.speaker === actorName) {
          // MODIFICATION 2 : Ajout du focus apr√®s la frappe
          typeText(nextMessage.text, () => {
            messageInput.focus();
          });
        }
      }

      function addMessage(text, type, username, profilePicture = null) {
        const messageContainer = document.createElement("div");
        messageContainer.classList.add(
          type === "sent" ? "align-right" : "align-left"
        );

        const messageDiv = document.createElement("div");
        messageDiv.classList.add("message", type);

        if (username) {
          const messageName = document.createElement("span");
          messageName.classList.add("message-name");
          messageName.textContent = username;
          messageDiv.appendChild(messageName);
        }

        const messageTextElement = document.createElement("span");
        messageTextElement.classList.add("message-text");
        messageTextElement.textContent = text;
        messageDiv.appendChild(messageTextElement);

        const messageTime = document.createElement("span");
        messageTime.classList.add("message-time");
        messageTime.textContent = getCurrentTime();
        messageDiv.appendChild(messageTime);

        if (profilePicture && type === "received") {
          const profilePictureImg = document.createElement("img");
          profilePictureImg.classList.add("profile-picture");
          profilePictureImg.src = interlocutorProfilePicture;
          messageContainer.insertBefore(
            profilePictureImg,
            messageContainer.firstChild
          );
        }

        messageContainer.appendChild(messageDiv);
        chatContainer.appendChild(messageContainer);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function getCurrentTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");
        return `${hours}:${minutes}`;
      }

      function getRandomDelay(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
      }

      function showTypingIndicator() {
        const indicatorContainer = document.createElement("div");
        indicatorContainer.classList.add("align-left");
        indicatorContainer.id = "typing-indicator-wrapper";

        const profilePictureImg = document.createElement("img");
        profilePictureImg.classList.add("profile-picture");
        profilePictureImg.src = interlocutorProfilePicture;
        indicatorContainer.appendChild(profilePictureImg);

        const typingIndicator = document.createElement("div");
        typingIndicator.classList.add("typing-indicator");
        typingIndicator.innerHTML = `<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>`;
        indicatorContainer.appendChild(typingIndicator);

        chatContainer.appendChild(indicatorContainer);
        chatContainer.scrollTop = chatContainer.scrollHeight;
        return indicatorContainer;
      }

      function removeTypingIndicator(indicator) {
        if (indicator && indicator.parentNode) {
          indicator.remove();
        }
      }

      handleNextMessage();
    </script>
  </body>
</html>
